(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},i=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};t=function(){function t(){this.documentReady=e(this.documentReady,this),this.removeEyecatcher=e(this.removeEyecatcher,this),this.upgradeEyecatcher=e(this.upgradeEyecatcher,this),this.setupEyecatcher=e(this.setupEyecatcher,this),this.getPrivateToken=e(this.getPrivateToken,this),this.setUnseenCount=e(this.setUnseenCount,this),this.getUnseenCount=e(this.getUnseenCount,this),this.getChangelogs=e(this.getChangelogs,this),this.widgetReady=e(this.widgetReady,this),this.setHeight=e(this.setHeight,this),this.setBadge=e(this.setBadge,this),this.showWidgetBadge=e(this.showWidgetBadge,this),this.toggle=e(this.toggle,this),this.triggerCallback=e(this.triggerCallback,this),this.reload=e(this.reload,this),this.hide=e(this.hide,this),this.updatePosition=e(this.updatePosition,this),this.setPosition=e(this.setPosition,this),this.getPosition=e(this.getPosition,this),this.show=e(this.show,this),this.setState=e(this.setState,this),this.migrateLocalStorage=e(this.migrateLocalStorage,this),this.lsSet=e(this.lsSet,this),this.lsGet=e(this.lsGet,this),this.lsSetState=e(this.lsSetState,this),this.lsGetState=e(this.lsGetState,this),this.lsKey=e(this.lsKey,this),this.onFrameLoad=e(this.onFrameLoad,this),this.attachListeners=e(this.attachListeners,this),this.readMessage=e(this.readMessage,this),this.ga=e(this.ga,this),this.markAllSeen=e(this.markAllSeen,this),this.markSeen=e(this.markSeen,this),this.markRead=e(this.markRead,this),this.trackEvent=e(this.trackEvent,this),this.onHideWidget=e(this.onHideWidget,this),this.onReadMore=e(this.onReadMore,this),this.onShowDetails=e(this.onShowDetails,this),this.onShowWidget=e(this.onShowWidget,this),this.onShowWidgetBadge=e(this.onShowWidgetBadge,this),this.onWidgetUpdate=e(this.onWidgetUpdate,this),this.onWidgetReady=e(this.onWidgetReady,this),this.setAction=e(this.setAction,this),this.makeInaccessible=e(this.makeInaccessible,this),this.makeAccessible=e(this.makeAccessible,this),this.createElements=e(this.createElements,this),this.setup=e(this.setup,this),this.realInit=e(this.realInit,this),this.init=e(this.init,this),this.log=e(this.log,this);var t;t="undefined"!=typeof HW_config&&null!==HW_config?HW_config:{},"undefined"!=typeof HW_config&&null!==HW_config&&this.init(t)}var s,n,o;return n=30,s="CaptainAmerica",o="#HW_badge_cont {\n  visibility: hidden;\n  pointer-events: none;\n  display: block;\n  height: 32px;\n  width: 32px;\n  cursor: pointer;\n  position: relative;\n}\n\n#HW_badge_cont.HW_visible {\n  visibility: visible;\n  pointer-events: auto;\n}\n\n#HW_badge {\n  display: block;\n  border-radius: 20px;\n  background: #CD4B5B;\n  height: 16px;\n  width: 16px;\n  color: #fff;\n  text-align: center;\n  line-height: 16px;\n  font-size: 11px;\n  cursor: pointer;\n  position: absolute;\n  top: 8px;\n  left: 8px;\n  opacity: 0;\n  transform: scale(0);\n  transition: all 0.3s;\n}\n\n#HW_badge.HW_softHidden {\n  background: #d4d4d4;\n  opacity: 1;\n  transform: scale(0.6);\n}\n\n#HW_badge.HW_hidden {\n  opacity: 0;\n  transform: scale(0);\n}\n\n#HW_badge.HW_visible {\n  opacity: 1;\n  transform: scale(1.0);\n}\n\n#HW_frame_cont {\n  pointer-events: none;\n  border-radius: 4px;\n  box-shadow: 0 0 1px rgba(99, 114, 130, 0.32), 0 8px 16px rgba(27, 39, 51, 0.08);\n  background: #fff;\n  border: none;\n  position: absolute;\n  top: -900em;\n  z-index: 2147483647;\n  width: 340px;\n  height: 0;\n  opacity: 0;\n  will-change: height, margin-top, opacity;\n  margin-top: -10px;\n  transition: margin-top 0.15s ease-out, opacity 0.1s ease-out, height 0.3s ease-out;\n}\n\n#HW_frame_cont.HW_visible {\n  opacity: 1;\n  pointer-events: auto;\n  margin-top: 0px;\n}\n\n#HW_frame {\n  background: #fff;\n  border: none;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  border-radius: 4px;\n  position: relative;\n  z-index: 2147483647;\n  transition: height 0.3s ease-out;\n}\n\n#HW_frame_cont.HW_embed {\n  position: static;\n  margin-top: 0;\n}",t.prototype.postMessage=function(){var t,e,i;return t=Array.prototype.slice.call(arguments),e=t.shift(),i=t,this.elements.frame.contentWindow.postMessage([s,e,i],"*")},t.prototype.log=function(){if(this.localOptions.debug)return console.log("[Headway Debug]",arguments)},t.prototype.warn=function(t){return console.warn("[Headway Error]",t)},t.prototype.init=function(t){var e;try{this.realInit(t)}catch(t){e=t,this.warn(e)}return this},t.prototype.realInit=function(t){if(this.localOptions=t||HW_config,this.accountId=this.localOptions.account,this.protocol=this.localOptions.protocol?this.localOptions.protocol+":":"https:",this.localOptions.enabled=null==this.localOptions.enabled||this.localOptions.enabled,this.destroy(),this.localOptions.enabled){if(null==this.localOptions.account)return this.warn("Cannot load widget, 'HW_config.account' is missing");if(this.localOptions.apiMode)this.localOptions.selector&&(delete this.localOptions.selector,this.warn("When in apiMode, 'selector' option is ignored")),this.localOptions.trigger&&(delete this.localOptions.trigger,this.warn("When in apiMode, 'trigger' option is ignored"));else if(null==this.localOptions.selector)return this.warn("Cannot load widget, 'HW_config.selector' is missing");return this.visible=!1,this.currentAlign="left",this.eyecatcherLevel=0,null!=this.localOptions.callbacks&&(this.localCallbacks=this.localOptions.callbacks),this.localOptions.callbacks=null,this.documentReady(this.setup)}},t.prototype.destroy=function(){var t,e,i,s,n,o;return t=document.querySelector("#HW_badge_cont"),e=document.querySelector("#HW_frame_cont"),i=document.querySelector("#HW_styles_cont"),null!=t&&null!=(s=t.parentNode)&&s.removeChild(t),null!=e&&null!=(n=e.parentNode)&&n.removeChild(e),null!=i&&null!=(o=i.parentNode)&&o.removeChild(i),this.widgetIsReady=!1,this.badgeIsReady=!1},t.prototype.setup=function(){return this.badgeEl=document.querySelector(this.localOptions.selector),this.badgeEl||this.localOptions.apiMode?(this.createElements(),this.makeInaccessible(),window.addEventListener("message",function(t){return function(e){var i,n,o,a;if(i=e.data,o=i[0],a=i[1],n=i[2],o===s)return t.readMessage(a,n)}}(this)),this.elements.frame.addEventListener("load",this.onFrameLoad)):this.warn("Element provided by selector does not exist.")},t.prototype.createElements=function(){var t,e;return this.elements={frameCont:document.createElement("div"),frame:document.createElement("iframe"),badgeCont:document.createElement("span"),badge:document.createElement("span"),style:document.createElement("style"),animate:document.createElement("link"),trigger:document.querySelectorAll(this.localOptions.trigger)},this.elements.style.id="HW_styles_cont",this.elements.style.textContent=o,document.body.appendChild(this.elements.style),this.localOptions.apiMode||this.localOptions.embed||(this.elements.badgeCont.id="HW_badge_cont",this.elements.badgeCont.addEventListener("click",this.toggle,!1),this.badgeEl.appendChild(this.elements.badgeCont),this.elements.badge.id="HW_badge",this.elements.badgeCont.appendChild(this.elements.badge)),this.elements.frameCont.id="HW_frame_cont",this.localOptions.embed&&this.elements.frameCont.classList.add("HW_embed"),(this.localOptions.embed?this.badgeEl:document.body).appendChild(this.elements.frameCont),t=this.localOptions.debugHost||"headway-widget.net",e=this.protocol+"//"+t+"/widgets/"+this.localOptions.account,null!=this.localOptions.token&&(e=e+"?token="+this.localOptions.token),this.elements.frame.id="HW_frame",this.elements.frame.src=e,this.elements.frame.sandbox="allow-same-origin allow-scripts allow-top-navigation allow-popups allow-forms",this.elements.frameCont.appendChild(this.elements.frame)},t.prototype.makeAccessible=function(){return this.elements.frame.setAttribute("tabindex","0"),this.elements.frame.setAttribute("aria-hidden","false")},t.prototype.makeInaccessible=function(){return this.elements.frame.setAttribute("tabindex","-1"),this.elements.frame.setAttribute("aria-hidden","true")},t.prototype.setAction=function(t,e){if("onShowDetails"===t.event&&this.onShowDetails(t.data),"onReadMore"===t.event)return this.onReadMore(t.data)},t.prototype.onWidgetReady=function(t){return this.triggerCallback("onWidgetReady",t)},t.prototype.onWidgetUpdate=function(t){return this.triggerCallback("onWidgetUpdate",t)},t.prototype.onShowWidgetBadge=function(t){return this.trackEvent("showBadge",{value:t})},t.prototype.onShowWidget=function(){return this.triggerCallback("onShowWidget"),this.trackEvent("openWidget",{action:"user"})},t.prototype.onShowDetails=function(t){return this.triggerCallback("onShowDetails",t),this.trackEvent("read: "+t.title,{action:"user"})},t.prototype.onReadMore=function(t){return this.triggerCallback("onReadMore",t),this.trackEvent("readMore: "+t.title,{action:"user"})},t.prototype.onHideWidget=function(){return this.triggerCallback("onHideWidget")},t.prototype.trackEvent=function(t,e){var i,s,n;return i=null!=(s=e.action)?s:"other",n=e.value,this.ga(t,i,n)},t.prototype.markRead=function(t){return this.postMessage("markRead",t)},t.prototype.markSeen=function(t){return this.postMessage("markSeen",t)},t.prototype.markAllSeen=function(){return this.postMessage("markAllSeen")},t.prototype.ga=function(t,e,i){if(this.localOptions.googleAnalytics&&"function"==typeof window.ga)return window.ga("send","event",{eventCategory:"Headway",eventLabel:t,eventAction:e,eventValue:i,nonInteraction:"user"!==e})},t.prototype.readMessage=function(t,e){switch(t){case"setHeight":return this.setHeight.apply(this,e);case"setBadge":return this.setBadge.apply(this,e);case"widgetReady":return this.widgetReady.apply(this,e);case"hide":return this.hide();case"setAction":return this.setAction.apply(this,e);case"setState":return this.setState.apply(this,e);case"migrateLocalStorage":return this.migrateLocalStorage.apply(this,e)}},t.prototype.attachListeners=function(){var t,e,i,s;if(this.ticking=!1,window.addEventListener("scroll",this.updatePosition),window.addEventListener("resize",this.updatePosition),document.body.addEventListener("click",function(t){return function(e){if(!t.localOptions.embed&&t.visible)return t.hide()}}(this)),this.elements.trigger)for(i=this.elements.trigger,t=0,e=i.length;t<e;t++)s=i[t],s.addEventListener("click",this.toggle);return this.log("Widget.attachListeners#triggers",this.elements.trigger)},t.prototype.onFrameLoad=function(){var t;return t={host:location.hostname,options:this.localOptions,localStorage:this.lsGetState()},this.postMessage("ready",t),this.log("Widget.attachListeners#load",t)},t.prototype.lsKey=function(t){return"HW_"+t+"Items["+this.accountId+"]"},t.prototype.lsGetState=function(){var t;return{seen:function(){var e,i,s,n;for(s=this.lsGet("seen"),n=[],e=0,i=s.length;e<i;e++)t=s[e],n.push(parseInt(t));return n}.call(this),read:function(){var e,i,s,n;for(s=this.lsGet("read"),n=[],e=0,i=s.length;e<i;e++)t=s[e],n.push(parseInt(t));return n}.call(this)}},t.prototype.lsSetState=function(t){var e,i,s;i=[];for(e in t)s=t[e],i.push(this.lsSet(e,s));return i},t.prototype.lsGet=function(t){var e,i,s;try{s=null!=(i=window.localStorage)?i.getItem(this.lsKey(t)):void 0}catch(t){e=t,this.warn(e)}return(null!=s?s.length:void 0)>0?s.split(","):[]},t.prototype.lsSet=function(t,e){var i,s,o;try{return e instanceof Array?null!=(s=window.localStorage)?s.setItem(this.lsKey(t),e.slice(-n).join(",")):void 0:null!=(o=window.localStorage)?o.removeItem(this.lsKey(t)):void 0}catch(t){return i=t,this.warn(i)}},t.prototype.migrateLocalStorage=function(){var t;return t=this.lsGetState(),this.lsSetState({seen:null,read:null,_seen:t.seen,_read:t.read}),this.reload()},t.prototype.setState=function(t){return this.state=t,"server"!==this.remoteOptions.activeStorage&&this.lsSetState(t),this.onWidgetUpdate(this),this.log("Widget.setState",t)},t.prototype.show=function(){return this.visible=!0,this.updatePosition(),this.elements.frameCont.classList.add("HW_visible"),this.postMessage("opened",{}),this.makeAccessible()},t.prototype.getPosition=function(t){var e,i,s,n,o,a,r,h;return s={badge:this.elements.badgeCont.getBoundingClientRect(),frame:this.elements.frameCont.getBoundingClientRect()},s.frame.height=parseInt(this.elements.frameCont.style.height),o=parseInt(s.frame.width),e=parseInt(s.badge.height),h={top:window.pageYOffset+e,right:o-s.badge.width},r={y:s.badge.top+s.frame.height>document.documentElement.clientHeight,x:s.badge.left>=document.body.scrollWidth-o},i=s.badge.left-o<0,a={y:r.y?"top":"bottom",x:r.x?"left":"right"},n=this.localOptions.position,(null!=n?n.y:void 0)&&(a.y=null!=n?n.y:void 0),(null!=n?n.x:void 0)&&(a.x=null!=n?n.x:void 0),i&&(a.x="fill"),[s.badge,s.frame,h,a]},t.prototype.setPosition=function(){var t,e,i,s,n;return n=this.getPosition(),t=n[0],e=n[1],s=n[2],i=n[3],"right"===i.x?this.elements.frameCont.style.left=t.left+"px":"left"===i.x?this.elements.frameCont.style.left=t.left-s.right+"px":this.elements.frameCont.style.left="0px","top"===i.y?this.elements.frameCont.style.top=t.top+s.top-e.height-t.height+"px":this.elements.frameCont.style.top=t.top+s.top+"px"},t.prototype.updatePosition=function(){if(!this.localOptions.embed&&this.visible)return this.ticking||window.requestAnimationFrame(function(t){return function(){return t.setPosition(),t.ticking=!1}}(this)),this.ticking=!0},t.prototype.hide=function(){return this.visible=!1,this.elements.frameCont.classList.remove("HW_visible"),this.postMessage("closed",{}),this.makeInaccessible(),this.onHideWidget(this)},t.prototype.reload=function(){return this.postMessage("reload")},t.prototype.triggerCallback=function(t,e){var i;if(e=Array.prototype.slice.call(arguments),t=e.shift(),null!=this.localCallbacks)return i=function(i){return function(){var s;return null!=(s=i.localCallbacks[t])?s.apply(i,e):void 0}}(this),setTimeout(i,0)},t.prototype.toggle=function(t){return t.preventDefault(),t.stopPropagation(),this.visible?this.hide():(this.show(),this.onShowWidget())},t.prototype.showWidgetBadge=function(){return this.badgeIsReady=!0,this.setBadge(this.getUnseenCount()),this.onShowWidgetBadge(this.getUnseenCount())},t.prototype.setBadge=function(t){if(this.setUnseenCount(t),this.badgeIsReady&&!this.localOptions.embed)return t>=1?(this.elements.badge.classList.add("HW_visible"),this.elements.badge.classList.remove("HW_softHidden"),this.elements.badge.innerText=t,this.remoteOptions.eyecatcher?this.setupEyecatcher():void 0):(this.removeEyecatcher(),this.remoteOptions.softHide?(this.elements.badge.classList.remove("HW_visible"),this.elements.badge.classList.add("HW_softHidden"),this.elements.badge.innerText=""):(window.setTimeout(function(t){return function(){return t.elements.badgeCont.classList.remove("HW_visible")}}(this),300),this.elements.badge.classList.remove("HW_visible"),this.elements.badge.classList.add("HW_hidden"),this.elements.badge.innerText=t))},t.prototype.setHeight=function(t){var e;return this.elements.frame.style.height=t.height+"px",this.elements.frameCont.style.height=t.height+"px",e=this.elements.frameCont.getBoundingClientRect().y+t.height,e>window.innerHeight?(this.widgetPositionUpdated=!0,this.setPosition()):this.widgetPositionUpdated?(this.setPosition(),this.widgetPositionUpdated=!1):void 0},t.prototype.widgetReady=function(t){if(this.attachListeners(),this.elements.badgeCont.classList.add("HW_visible"),this.remoteOptions=t.options,this.state=t.state,this.setBadge(t.badgeCount),window.setTimeout(function(t){return function(){return t.showWidgetBadge()}}(this),1e3*(this.widgetIsReady?1:this.remoteOptions.badgeDelay)),this.log("Widget.widgetReady",t),this.changelogs=t.changelogs,this.widgetIsReady||(this.widgetIsReady=!0,this.onWidgetReady(this)),this.onWidgetUpdate(this),this.localOptions.embed)return this.show()},t.prototype.getChangelogs=function(){var t,e,s,n,o,a;for(n=this.changelogs,e=0,s=n.length;e<s;e++)t=n[e],t.read=(o=t.id,i.call(this.lsGet("read"),o)>=0),t.seen=(a=t.id,i.call(this.lsGet("seen"),a)>=0);return this.changelogs},t.prototype.getUnseenCount=function(){return this.unseenCount},t.prototype.setUnseenCount=function(t){return this.unseenCount=t,this.elements.badge.dataset.countUnseen=t>0?t:""},t.prototype.getPrivateToken=function(){if(!this.widgetIsReady)throw"getPrivateToken has to be called after `onWidgetReady` callback";return this.remoteOptions.token},t.prototype.setupEyecatcher=function(){var t;return document.body.appendChild(this.elements.animate),this.elements.animate.rel="stylesheet",this.elements.animate.href=this.protocol+"//cdn.headwayapp.co/headway-animate.css",t=["blank","pulse","jello","rubberBand","wobble","shake","bounce"],this.elements.badge.classList.add("HW_animated"),this.upgradeEyecatcher(t)},t.prototype.upgradeEyecatcher=function(t){var e;return e=0,window.setInterval(function(i){return function(){var s;return s="HW_"+t[i.eyecatcherLevel],t.length===i.eyecatcherLevel&&(s=t[t.length-1]),i.elements.badge.classList.add(s),window.setTimeout(function(){if(i.elements.badge.classList.remove(s),(e+=1)>=5)return e=0,i.eyecatcherLevel=i.eyecatcherLevel+1,i.elements.badge.classList.remove(s)},1e3)}}(this),5500)},t.prototype.removeEyecatcher=function(){return this.elements.badge.className=""},t.prototype.documentReady=function(t){switch(document.readyState){case"interactive":case"complete":return t();default:return window.addEventListener("DOMContentLoaded",t,!1)}},t}(),window.Headway=new t}).call(this);